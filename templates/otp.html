{% extends "auth_base.html" %}

{% block content %}
<div class="relative z-10 w-full max-w-lg p-8" x-data="otpSystem()">
    <div class="bg-[#0f172a]/80 backdrop-blur-xl border border-slate-700 p-10 rounded-3xl shadow-2xl text-center">
        <div class="w-20 h-20 mx-auto bg-slate-900 rounded-full flex items-center justify-center border border-slate-700 mb-6">
            <i class="fas fa-shield-alt text-3xl text-blue-500"></i>
        </div>
        <h2 class="text-3xl font-bold text-white mb-2 tech-font">Verify Access</h2>
        <p class="text-slate-400 mb-8 text-sm">Enter the code sent to <span class="text-white" x-text="email"></span></p>
        
        <div class="flex justify-center gap-4 mb-8">
            <template x-for="(digit, index) in code" :key="index">
                <input type="text" maxlength="1" x-model="code[index]" @input="handleInput($event, index)" 
                       :id="'otp-' + index" 
                       class="w-14 h-16 bg-slate-800 border-2 border-slate-600 rounded-xl text-center text-2xl text-white focus:border-blue-500 focus:outline-none transition-colors">
            </template>
        </div>

        <button @click="verify()" :disabled="code.join('').length < 4 || loading" class="w-full bg-blue-600 hover:bg-blue-500 disabled:opacity-50 text-white font-bold py-4 rounded-xl shadow-lg transition-all">
            <span x-show="!loading">CONFIRM IDENTITY</span>
            <span x-show="loading"><i class="fas fa-circle-notch fa-spin"></i> VERIFYING...</span>
        </button>
    </div>
</div>

<script>
    function otpSystem() {
        return {
            code: ['', '', '', ''], 
            loading: false,
            email: '',
            init() { 
                // قراءة الإيميل من البيانات المحفوظة في الخطوة السابقة
                const savedData = JSON.parse(localStorage.getItem('signupData') || '{}');
                this.email = savedData.email || 'your email';
                this.$nextTick(() => document.getElementById('otp-0').focus()); 
            },
            handleInput(e, index) {
                if (e.target.value.length === 1 && index < 3) document.getElementById('otp-' + (index + 1)).focus();
            },
            verify() {
                this.loading = true;
                setTimeout(() => {
                    this.loading = false;
                    // ✅ التوجيه للخطوة التالية: الموديولات (Puzzle)
                    window.location.href = "{% url 'modules_page' %}"; 
                }, 1500);
            }
        }
    }
</script>
{% endblock %}